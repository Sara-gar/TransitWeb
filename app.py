from flask import Flask, request, render_template
import geopy.distance
import folium
import os

app = Flask(__name__)

# Coordenadas de los barrios
# Coordenadas de los barrios con nombres
barrios = {
    "CALLEJON": (7.874277107626152, -72.48698573358314),
    "CENTRO": (7.889313119030642, -72.50393995707925),
    "CONTENTO": (7.881259462458628, -72.50977423835585),
    "LA PLAYA": (7.917376792928296, -72.50306940935123),
    "LA NUEVA SEXTA": (7.929330694047017, -72.49486871597887),
    "LATINO": (7.891188773146745, -72.49995363324513),
    "LLANO": (7.884903084744013, -72.50905071482815),
    "PARAMO": (7.888556750358848, -72.50319294602552),
    "ACUARELA": (7.877966782686918, -72.48954782883557),
    "BALCONES DE SAN FRANCISCO": (7.871285257930859, -72.50099832883559),
    "BLANCO": (7.878350916798598, -72.49898311787454),
    "CAOBOS": (7.8844098983960365, -72.49522950554832),
    "CEIBA I": (7.895472196139859, -72.49670347641802),
    "CEIBA II": (7.9041872794467105, -72.49641030144211),
    "COLSAG": (7.893208966250292, -72.48872110823274),
    "COMERCIAL BOLIVAR": (7.88460925435659, -72.48721632069176),
    "CONDADO DE CASTILLA": (7.907447206493414, -72.48643485144967),
    "EL ROSAL": (7.914131684044888, -72.51027674468948),
    "GALICIA": (7.911469366193925, -72.4855719852134),
    "GOVIKA": (7.901768135431922, -72.49148544912394),
    "HACARITAMA": (7.905672044871281, -72.48501291884548),
    "HURAPANES": (7.910096321540912, -72.49131141181574),
    "LA CAPILLANA": (7.900761522287127, -72.49559388032205),
    "LA CASTELLANA": (7.9013788993514735, -72.49883382532792),
    "LA CEIBA": (7.898215637080683, -72.49708847593199),
    "LA ESPERANZA": (7.850284994116485, -72.47859184911077),
    "LA PRIMAVERA": (7.919744454769699, -72.53648154041727),
    "LA RINCONADA": (7.868730628986186, -72.4979069236907),
    "LA RIVIERA": (7.888516772923694, -72.49246523089619),
    "LAS ALMEYDAS": (7.9064931110066174, -72.48637653694564),
    "LIBERTADORES": (7.890861826185439, -72.48797320151894),
    "LOS ACACIOS": (7.906433321781967, -72.49037160722634),
    "LOS PINOS": (7.901955759701858, -72.4944926732315),
    "LOS PROCERES": (7.910614723027533, -72.48729998401687),
    "MANOLO LEMUS": (7.9117029594735575, -72.48629729948486),
    "MIRADOR CAMPESTRE": (7.877342707270953, -72.49074421921014),
    "PALMA REAL": (7.902981877139971, -72.48350079329153),
    "PARQUE REAL": (7.900605056609617, -72.48408671709706),
    "PARQUES RESIDENCIALES LOS LIBERTADORES": (7.903154450150349, -72.48465924910845),
    "POPULAR": (7.8922590911935835, -72.4952364489857),
    "PRADOS CLUB": (7.9025956773080495, -72.48684863949211),
    "PRADOS I": (7.900520556714038, -72.48637547572784),
    "PRADOS II": (7.899168772470804, -72.48595350407098),
    "QUINTA BOSCH": (7.895905084527791, -72.49326534120375),
    "QUINTA ORIENTAL": (7.89792456397914, -72.48926639877335),
    "QUINTA VELEZ": (7.88663163774768, -72.49652710677566),
    "RINCON DE LOS PRADOS": (7.905116645251983, -72.48475564726114),
    "SAN ISIDRO": (8.23586823718631, -72.4667364813837),
    "SAN REMO": (7.818234756001702, -72.51373019996187),
    "SANTA LUCIA": (7.9050998298215776, -72.49256096840385),
    "SAYAGO": (7.891066526391795, -72.49270796444542),
    "VALPARAISO SUIT": (7.905254355201769, -72.48599371006301),
    "AGUAS CALIENTES": (7.883402600604837, -72.47326174400152),
    "BELLAVISTA": (7.880386809174693, -72.47912944726824),
    "BOCONO": (7.894608680934501, -72.46321137165074),
    "BOGOTA": (7.8738836258731935, -72.48683631131445),
    "LA CAROLINA": (7.880675706836997, -72.46505514965212),
    "LA LIBERTAD": (7.888173171258412, -72.47719639770298),
    "LA UNION": (7.893498235709197, -72.46749812111554),
    "LAS MARGARITAS": (7.894462859213873, -72.46384944368165),
    "MORELLY": (7.872210110079893, -72.48262805369025),
    "POLICARPA": (7.884569631363863, -72.46652584753976),
    "SAN MATEO": (7.882402581419708, -72.48465266208066),
    "SANTA ANA": (7.8911458339568865, -72.46527075397272),
    "URBANIZACION SANTA ANA": (7.887623819362318, -72.46247953746526),
    "VALLE ESTHER": (7.887172748660645, -72.47241079512492),
    "ALTO PAMPLONITA": (7.901886230794705, -72.47390540537396),
    "ANIVERSARIO I": (7.891891158670204, -72.47547180224859),
    "ANIVERSARIO II": (7.888961185380557, -72.46981482929647),
    "BAJO PAMPLONITA": (7.9000906438717875, -72.47734431396708),
    "BOSQUES DEL PAMPLONITA": (7.88739585560918, -72.48660863241263),
    "CAÑAFISTOLO": (7.898837697504547, -72.46791906545775),
    "EL HIGUERON": (7.905155140233055, -72.46643917976071),
    "ESTACION DEL ESTE": (7.913681590475758, -72.4741194976893),
    "HELIOPOLIS": (7.903280633584619, -72.46423301409553),
    "LA ALAMEDA": (7.910533492398209, -72.46680696577624),
    "LA CAMPIÑA": (7.898261130013988, -72.49602309042335),
    "LA FLORIDA": (7.883083825607884, -72.47890582413822),
    "NUEVO ESCOBAL": (7.914844265957217, -72.46554224670568),
    "PORTAL DEL ESCOBAL": (7.9148720885701715, -72.46546990436462),
    "PRADOS DEL ESTE": (7.908343385156373, -72.47256410943122),
    "CONJUNTO PRADOS DEL ESTE": (7.905990575290932, -72.47472862095185),
    "SAN LUIS": (7.894818046597923, -72.48260760823847),
    "SAN MARTIN I": (7.863407079169164, -72.47938932200329),
    "SAN MARTIN II": (7.905366066360011, -72.47092338201723),
    "SANTA TERESITA": (7.889818500942055, -72.48114741577999),
    "SANTILLANA": (7.902374657297263, -72.46424071793524),
    "TERRANOVA": (7.882061304511331, -72.46479969330468),
    "TORCOROMA": (7.893813862424519, -72.47301012686818),
    "TORCOROMA SIGLO XXI": (7.8985186557809985, -72.47016251419576),
    "VIEJO ESCOBAL": (7.9131977589570734, -72.46461998224358),
    "VILLA CAMILA": (7.902526301577618, -72.47852310660326),
    "VILLAS DE SAN DIEGO": (7.911309950363787, -72.465908490806),
    "ALCALA": (7.91331646365523, -72.48770890410553),
    "CIUDAD JARDIN": (7.909549654548423, -72.489053677959),
    "COLPET": (7.90359003304669, -72.50412625259774),
    "EL BOSQUE": (7.911211924197598, -72.49984376600563),
    "GRATAMIRA": (7.913437857383545, -72.48902898548177),
    "GUAIMARAL": (7.90989473302893, -72.49316236027329),
    "GUALANDAY": (7.911477324234985, -72.49531675712477),
    "JUANA RANGEL DE CUELLAR": (7.919932362577155, -72.51718869324503),
    "LA MARIA": (7.902938853112632, -72.50476831137047),
    "LA MERCED": (7.897242669785049, -72.50568920428788),
    "LINARES": (7.911494771303246, -72.48844149795393),
    "LLERAS RESTREPO": (7.897960249659833, -72.50115602208385),
    "LOS ANGELES": (7.890051624132806, -72.49896283880868),
    "NIZA": (7.91596127657012, -72.4897855449498),
    "PARAISO": (7.904815739639198, -72.48514276700311),
    "PESCADERO": (7.903040216125232, -72.50349938607765),
    "PORTACHUELO": (7.913377146713045, -72.4998470202321),
    "PRADOS DEL NORTE": (7.916959482494447, -72.49814460351207),
    "SAN EDUARDO I Y II": (7.9044279107518625, -72.48749930859238),
    "SANTA HELENA": (7.917562831935213, -72.48950337094743),
    "SEVILLA": (7.899964475254843, -72.50722837978813),
    "TASAJERO": (7.9203951178204814, -72.49246991650818),
    "ZULIMA I,II,III Y IV ETAPA": (7.914405658508916, -72.49125598559267),
    "20 DE DICIEMBRE": (7.9210547448705615, -72.50526352820303),
    "6 DE MAYO": (7.91727531727452, -72.51012115570748),
    "8 DE DICIEMBRE": (7.916601704776629, -72.5081953215276),
    "AEROPUERTO": (7.916601704776629, -72.5081953215276),
    "ALONSITO": (7.9446273488350725, -72.51600703157322),
    "BRISAS DEL AEROPUERTO": (7.917387986461186, -72.51320976806905),
    "BRISAS DEL NORTE": (7.91996469786479, -72.50749167597039),
    "CAMILO DAZA": (7.940984775250547, -72.52613838559182),
    "CAÑO LIMON": (7.948016808256213, -72.51885392549805),
    "CARLOS GARCIA LOZADA": (7.914049594349079, -72.50350340140618),
    "CARLOS PIZARRO": (7.912532926739276, -72.50501962171415),
    "CECILIA CASTRO": (7.916139898998822, -72.50563473557636),
    "CERRO DE LA CRUZ": (7.9057394513647665, -72.51197238457979),
    "CERRO NORTE": (7.917839169325309, -72.51024434723027),
    "COLINAS DEL SALADO": (7.938210416883557, -72.49474111147333),
    "CONJ. CERRADO MOLINOS DEL NORTE": (7.95002677269645, -72.51090371331671),
    "CUMBRES DEL NORTE": (7.9397778292157675, -72.49722336812968),
    "DIVINO NIÑO": (7.897216973634568, -72.50917147297262),
    "EL SALADO": (7.950251867928084, -72.49995266192603),
    "ESPERANZA MARTINEZ": (7.917257042942535, -72.51066785024342),
    "GARCIA HERREROS I Y II": (7.9323916379258925, -72.4945186958527),
    "LA CONCORDIA": (7.94485794399028, -72.49998345424783),
    "LA INSULA": (7.929961929620271, -72.49922239058574),
    "LIMONAR DEL NORTE": (7.948358455804831, -72.50557043186096),
    "LOS LAURELES": (7.870890993478546, -72.47316538345859),
    "MARIA AUXILIADORA": (8.194065568568453, -72.49338568678309),
    "MARIA PAZ": (7.9114561880836, -72.50775758671887),
    "MOLINOS DEL NORTE": (7.949822237396065, -72.5090079913963),
    "NUEVA COLOMBIA": (7.912235303706548, -72.50497263477561),
    "OLGA TERESA": (7.918913455115091, -72.50902536441494),
    "PANAMERICANO": (7.935568646583138, -72.49658756508983),
    "PORVENIR": (7.93967066601172, -72.50599821092672),
    "RAFAEL NUÑEZ": (7.924863448737522, -72.52299861313661),
    "SAN GERARDO": (7.94723611839391, -72.4907841327781),
    "SIMON BOLIVAR I": (7.945732888332048, -72.51873186215298),
    "TOLEDO PLATA": (7.942278799592479, -72.51099525497166),
    "TRIGAL DEL NORTE": (7.947437865965827, -72.50795061334397),
    "URBANIZACION LAS AMERICAS": (7.920744061034571, -72.50630975114852),
    "VILLA JULIANA": (7.945007527724876, -72.50103753252047),
    "VILLA NUEVA": (7.881535469764461, -72.5093121043289),
    "VILLAS DEL TEJAR": (7.943615219787597, -72.50808127151592),
    "VIRGILIO BARCO": (7.942132262995599, -72.5023441644125),
    "BUENOS AIRES": (7.927466900485431, -72.52030714450696),
    "CHAPINERO": (7.914620834272485, -72.52184183394519),
    "CLARET": (7.911793863683816, -72.52840578065147),
    "COMUNEROS": (7.911608463160376, -72.52155489261906),
    "EL ROSAL DEL NORTE": (7.914607091770849, -72.50987223812776),
    "LA HERMITA": (7.932953728003573, -72.51712156255778),
    "LA LAGUNA": (7.9168500335117775, -72.51576279297264),
    "LAS AMERICAS": (7.918406618476159, -72.50996813595418),
    "MOTILONES": (7.917057798644781, -72.52959867790366),
    "OSPINA PEREZ": (7.922989068488502, -72.52305859224772),
    "TUCUNARE": (7.914648838126093, -72.53182285631249),
    "6 DE ENERO": (7.901711458639803, -72.51414081876338),
    "7 DE AGOSTO": (7.902349647989894, -72.52747347752346),
    "ANTONIA SANTOS": (7.908894475341627, -72.5397004297369),
    "ATALAYA": (7.90629045414927, -72.52203528358164),
    "ATALAYA I, II Y III ETAPA": (7.9075650218488915, -72.51801453557502),
    "BELISARIO": (7.898770252610926, -72.53794317015284),
    "CARLOS RAMIREZ PARIS": (7.895816796827787, -72.5263685860433),
    "CERRO PICO": (7.918119699994765, -72.5449042496274),
    "CUCUTA 75": (7.899745049065503, -72.52128579336242),
    "DOÑA NIDIA": (7.8893797931061105, -72.53058196812317),
    "EL DESIERTO": (7.896895875323639, -72.52164316678258),
    "EL MINUTO DE DIOS": (7.897825395592574, -72.4960822626305),
    "EL PROGRESO": (7.918779360288868, -72.54444231904313),
    "EL RODEO": (7.893227611241331, -72.54947744219297),
    "JUAN RANGEL": (7.892734568840832, -72.5448376367065),
    "LA VICTORIA": (7.902202834334334, -72.51613993797034),
    "LOS ALMENDROS": (7.901865459474621, -72.51990798363556),
    "NIÑA CECI": (7.8973604335979575, -72.5293721088255),
    "NUEVO HORIZONTE": (7.8966686336248975, -72.5394538356465),
    "PALMERAS": (7.907172755412492, -72.53197287943799),
    "VALLES DEL RODEO": (7.877216359266007, -72.53801301608125),
    "28 DE FEBRERO": (7.891093945198438, -72.52018397982577),
    "ARNULFO BRICEÑO": (7.9014341227953135, -72.48485928859839),
    "BARRIO NUEVO": (7.925969003452778, -72.51656431610654),
    "BELEN": (7.876063413692393, -72.53410557024975),
    "BELEN DE UMBRIA": (7.878567663157535, -72.53500171757071),
    "CARORA": (7.8951492654628685, -72.51050945477208),
    "CUNDINAMARCA": (7.888752805638121, -72.51843286198852),
    "DIVINA PASTORA": (7.872922308250259, -72.53547091220447),
    "FATIMA": (7.88599736178876, -72.52080402436684),
    "LAS COLINAS": (7.871278171815965, -72.52315953564273),
    "LOMA DE BOLIVAR": (7.891089662701708, -72.51738523208473),
    "LOS ALPES": (7.897246721842514, -72.51527140553496),
    "RUDESINDO SOTO": (7.880467585301608, -72.52733888896063),
    "SAN MIGUEL": (7.887080860517184, -72.51456840626709),
    "ALFONSO LOPEZ": (7.876871557750886, -72.51100398757194),
    "CIRCUNVALACION": (7.879894814061, -72.50468607449973),
    "CUBEROS NIÑO": (7.877455844992663, -72.50667099874313),
    "EL RESUMEN": (7.856785912353832, -72.51363401014589),
    "GAITAN": (7.8753156512726585, -72.5235267734163),
    "GALAN": (7.83223310375109, -72.47212720585145),
    "DIVINA PASTORA": (7.872922308250259, -72.53547091220447),
    "FATIMA": (7.88599736178876, -72.52080402436684),
    "LA CABRERA": (7.879333757682081, -72.50438030910186),
    "LAS MALVINAS": (7.874148900444212, -72.53196898949122),
    "MAGDALENA": (7.88168895548972, -72.52393183353485),
    "PUENTE BARCO": (7.881030050946819, -72.50114378690874),
    "SAN JOSE": (7.892980521813042, -72.47778200458667),
    "SAN RAFAEL": (7.8700241562878, -72.50566656988964),
    "SANTANDER": (7.868562261919397, -72.52167057129189),
    "SANTO DOMINGO": (7.868562261919397, -7.875035682154686, -72.50380469592687),
    "MONTEBELLO I": (7.8042936990120815, -72.52050055201252)
    # Agrega más barrios aquí
}

# Coordenadas de los paraderos con nombres y descripciones
paraderos = {
    "Paradero 1": {"coordenadas": (7.89393, -72.4909), "descripcion": "Frente Cancha Catedral De Futbol Gran Colombia Cúcuta."},
    "Paradero 2": {"coordenadas": (7.89111, -72.49483), "descripcion": "Frente Al Palacio De Justicia."},
    "Paradero 3": {"coordenadas": (7.89005, -72.4985), "descripcion": "Fuente a la Fuente  Luminosa"},
    "Paradero 4": {"coordenadas": (7.87323, -72.50091), "descripcion": "Frente Iglesia San Rafael."},
    "Paradero 5": {"coordenadas": (7.8287, -72.51175), "descripcion": "Frente Iglesia Cristiana Cuadrangular Los Patios."},
    "Paradero 6": {"coordenadas": (7.82435, -72.51323), "descripcion": "Frente Al Colegio 11 Noviembre."},
    "Paradero 7": {"coordenadas": (7.81432, -72.51651), "descripcion": "En El Puente Rojo Cerca A Jm."},
    "Paradero 8": {"coordenadas": (7.80564, -72.51818), "descripcion": "Parque Antes De Paradero Buseta De TRASAN En Montebello."}
    # Agrega más paraderos aquí
}

# Coordenadas de los puntos por donde pasa la ruta del bus
ruta_bus = [
    (7.9405556, -72.5238889),
(7.9408333, -72.5238889),
(7.9408333, -72.5238889),
(7.9408333, -72.5236111),
(7.9405556, -72.5233333),
(7.9405556, -72.5230556),
(7.9402778, -72.5227778),
(7.9402778, -72.5222222),
(7.9400000, -72.5219444),
(7.9400000, -72.5216667),
(7.9397222, -72.5213889),
(7.9397222, -72.5211111),
(7.9394444, -72.5211111),
(7.9391667, -72.5208333),
(7.9388889, -72.5208333),
(7.9383333, -72.5205556),
(7.9375000, -72.5200000),
(7.9366667, -72.5194444),
(7.9366667, -72.5197222),
(7.9363889, -72.5197222),
(7.9363889, -72.5197222),
(7.9363889, -72.5194444),
(7.9361111, -72.5188889),
(7.9355556, -72.5188889),
(7.9355556, -72.5188889),
(7.9316667, -72.5194444),
(7.9302778, -72.5197222),
(7.9297222, -72.5197222),
(7.9286111, -72.5205556),
(7.9272222, -72.5188889),
(7.9144444, -72.5297222),
(7.9136111, -72.5300000),
(7.9130556, -72.5300000),
(7.9125000, -72.5302778),
(7.9122222, -72.5280556),
(7.9083333, -72.5283333),
(7.9080556, -72.5269444),
(7.9080556, -72.5266667),
(7.9080556, -72.5266667),
(7.9083333, -72.5266667),
(7.9083333, -72.5263889),
(7.9083333, -72.5263889),
(7.9080556, -72.5258333),
(7.9080556, -72.5258333),
(7.9080556, -72.5255556),
(7.9077778, -72.5252778),
(7.9075000, -72.5180556),
(7.9077778, -72.5177778),
(7.9077778, -72.5177778),
(7.9080556, -72.5177778),
(7.9152778, -72.5169444),
(7.9158333, -72.5133333),
(7.9213889, -72.5055556),
(7.9222222, -72.5047222),
(7.9225000, -72.5047222),
(7.9227778, -72.5044444),
(7.9227778, -72.5041667),
(7.9216667, -72.5013889),
(7.9216667, -72.5013889),
(7.9216667, -72.5011111),
(7.9216667, -72.5008333),
(7.9191667, -72.4952778),
(7.9147222, -72.4883333),
(7.9136111, -72.4877778),
(7.9122222, -72.4875000),
(7.9077778, -72.4866667),
(7.9077778, -72.4894444),
(7.9055556, -72.4888889),
(7.9050000, -72.4916667),
(7.8944444, -72.4897222),
(7.8900000, -72.4955556),
(7.8888889, -72.4963889),
(7.8891667, -72.4969444),
(7.8877778, -72.5022222),
(7.8783333, -72.5000000),
(7.8780556, -72.4997222),
(7.8766667, -72.4994444),
(7.8719444, -72.5011111),
(7.8716667, -72.5013889),
(7.8688889, -72.5013889),
(7.8683333, -72.5013889),
(7.8672222, -72.5013889),
(7.8669444, -72.5013889),
(7.8666667, -72.5013889),
(7.8666667, -72.5013889),
(7.8663889, -72.4991667),
(7.8663889, -72.4988889),
(7.8661111, -72.4986111),
(7.8661111, -72.4980556),
(7.8661111, -72.4980556),
(7.8661111, -72.4980556),
(7.8661111, -72.4983333),
(7.8650000, -72.4994444),
(7.8641667, -72.4997222),
(7.8630556, -72.4994444),
(7.8627778, -72.4994444),
(7.8622222, -72.4997222),
(7.8611111, -72.5002778),
(7.8533333, -72.5025000),
(7.8491667, -72.5044444),
(7.8488889, -72.5047222),
(7.8480556, -72.5050000),
(7.8219444, -72.5136111),
(7.8219444, -72.5136111),
(7.8216667, -72.5136111),
(7.8213889, -72.5136111),
(7.8213889, -72.5138889),
(7.8208333, -72.5138889),
(7.8144444, -72.5161111),
(7.8058333, -72.5175000),
(7.8050000, -72.5180556),
(7.8044444, -72.5191667),
(7.8041667, -72.5191667),
(7.8025000, -72.5200000),
(7.8025000, -72.5200000),
(7.8025000, -72.5202778),
(7.8036111, -72.5200000),
(7.8044444, -72.5191667),
(7.8050000, -72.5194444),
(7.8050000, -72.5194444)
    # Agrega más puntos de la ruta aquí
]

# Función para calcular distancia
def calcular_distancia(coord1, coord2):
    return geopy.distance.distance(coord1, coord2).km

# Función para calcular tiempo estimado de caminata (5 km/h)
def calcular_tiempo(distancia):
    velocidad_caminata = 5  # km/h
    tiempo_horas = distancia / velocidad_caminata
    tiempo_minutos = tiempo_horas * 60
    minutos = int(tiempo_minutos)
    segundos = int((tiempo_minutos - minutos) * 60)
    return minutos, segundos

@app.route('/')
def home():
    return render_template('formulario.html', barrios=barrios)

@app.route('/generar_mapa', methods=['POST'])
def generar_mapa():
    # Obtener la ubicación y destino seleccionados
    origen = request.form.get('origen')
    destino = request.form.get('destino')

    ubicacion_usuario = barrios[origen]
    ubicacion_destino = barrios[destino]

    # Calcular los tres paraderos más cercanos
    distancias = []
    for nombre, info in paraderos.items():
        coordenadas = info["coordenadas"]
        distancia = calcular_distancia(ubicacion_usuario, coordenadas)
        minutos, segundos = calcular_tiempo(distancia)
        distancias.append((nombre, distancia, info["descripcion"], minutos, segundos))

    distancias.sort(key=lambda x: x[1])
    top_3_paraderos = distancias[:3]

    # Generar el mapa
    mapa = folium.Map(location=ubicacion_usuario, zoom_start=14)
    folium.Marker(ubicacion_usuario, tooltip='Ubicación Actual').add_to(mapa)
    folium.Marker(ubicacion_destino, tooltip='Destino').add_to(mapa)
    folium.PolyLine([ubicacion_usuario, ubicacion_destino], color='green', tooltip='Ruta Origen-Destino').add_to(mapa)
    for nombre, distancia, descripcion, minutos, segundos in top_3_paraderos:
        folium.Marker(paraderos[nombre]["coordenadas"], tooltip=f"{nombre}: {descripcion} - Tiempo estimado: {minutos} minutos y {segundos} segundos").add_to(mapa)
        folium.PolyLine([ubicacion_usuario, paraderos[nombre]["coordenadas"]], color='blue').add_to(mapa)

    # Añadir la ruta del bus
    folium.PolyLine(ruta_bus, color='red', tooltip='Ruta del Bus').add_to(mapa)

    # Guardar el mapa
    mapa_path = os.path.join('static', 'ruta.html')
    mapa.save(mapa_path)

    return render_template('mapa.html', mapa_url=mapa_path)


if __name__ == '__main__':
    port = int(os.environ.get('PORT', 5000))  # Puerto proporcionado por Render
    app.run(host='0.0.0.0', port=port, debug=True)